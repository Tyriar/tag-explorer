/*!
 * tag-explorer
 * http://github.com/Tyriar/tag-explorer
 *
 * Copyright 2015 Daniel Imms (http://www.growingwiththeweb.com)
 * Released under the MIT license
 * http://github.com/Tyriar/tag-explorer/blob/master/LICENSE
 */
var tagExplorer=function(a,b,c){"use strict";function d(){String.prototype.localeCompare?c.sort(function(a,b){return a.localeCompare(b)}):c.sort();for(var b,d="",e=document.createElement("menu"),f=0;f<c.length;f++){b=void 0,d.toUpperCase()!==c[f][0].toUpperCase()&&(d=c[f][0].toUpperCase(),d.match(/[0-9.]/g)&&(d="#"),b=document.createElement("div"),b.textContent=d,b.setAttribute("aria-hidden","true"),b.classList.add("letter-header"));var h=document.createElement("button");h.textContent=c[f],h.addEventListener("click",g.bind(null,h)),u[c[f]]={element:h,neighbours:[]};var i=document.createElement("li");b&&i.appendChild(b),i.appendChild(h),e.appendChild(i)}a.classList.add("show-all"),a.appendChild(e)}function e(){var a,c,d;for(a=0;a<b.length;a++)for(c=0;c<b[a].tags.length;c++)for(d=0;d<b[a].tags.length;d++)c!==d&&-1===u[b[a].tags[c]].neighbours.indexOf(b[a].tags[d])&&u[b[a].tags[c]].neighbours.push(b[a].tags[d]);for(a=0;a<s.length;a++)for(c=0;c<s[a].tags.length;c++)for(d=0;d<s[a].tags.length;d++)c!==d&&-1===u[s[a].tags[c]].neighbours.indexOf(s[a].tags[d])&&u[s[a].tags[c]].neighbours.push(s[a].tags[d])}function f(){var a,c=r("t");if(c){var d=c.split(",");for(a=0;a<d.length;a++){var e=u[d[a]];e&&g(e.element)}}for(a=0;a<b.length;a++)b[a].element.classList.add("active")}function g(a){a.classList.contains("selected")?(a.classList.remove("selected"),h(a.textContent),o(a.textContent)):(a.classList.add("selected"),i(a.textContent),n(a.textContent))}function h(a){for(var b=0;b<t.length;b++)if(t[b]===a){t.splice(b,1);break}k(a)}function i(a){t.push(a),j(a)}function j(a){for(var c=0;c<b.length;c++)-1===b[c].tags.indexOf(a)&&m(c--)}function k(b){var c;if(!t.length){for(c=0;c<s.length;c++)l(c--);var d=a.querySelectorAll(".active");for(c=0;c<d.length;c++)d[c].classList.remove("active")}for(c=0;c<s.length;c++)if(-1===s[c].tags.indexOf(b)){for(var e=!0,f=0;f<t.length;f++)if(-1===s[c].tags.indexOf(t[f])){e=!1;break}e&&l(c--)}}function l(a){s[a].element.classList.add("active"),b.push(s[a]),s.splice(a,1)}function m(a){b[a].element.classList.remove("active"),s.push(b[a]),b.splice(a,1)}function n(c){var d;if(a.classList.contains("show-all")&&a.classList.remove("show-all"),1===t.length)for(d=0;d<u[c].neighbours.length;d++)u[u[c].neighbours[d]].element.classList.add("active");else{var e=!0;for(d=0;d<t.length;d++)t[d]!==c&&-1===u[t[d]].neighbours.indexOf(c)&&(e=!1);var f;if(e){for(f=a.querySelectorAll(".active:not(.selected)"),d=0;d<f.length;d++)-1===u[c].neighbours.indexOf(f[d].innerHTML)&&f[d].classList.remove("active");for(d=0;d<f.length;d++){for(var g=!1,h=0;h<b.length;h++)if(-1!==b[h].tags.indexOf(f[d].innerHTML)){g=!0;break}g||f[d].classList.remove("active")}}else for(f=a.querySelectorAll(".active:not(.selected)"),d=0;d<f.length;d++)f[d].classList.remove("active")}u[c].element.classList.add("active")}function o(b){var c;if(t.length){if(q()){var d=a.querySelectorAll("button:not(.active)");for(c=0;c<d.length;c++)p(d[c])}var e=!1;for(c=0;c<t.length;c++)for(var f=0;f<u[t[c]].neighbours.length;f++)if(-1===u[t[c]].neighbours.indexOf(b)){e=!0;break}e&&u[b].element.classList.remove("active"),p(u[b].element)}else for(a.classList.add("show-all"),c=0;c<u.length;c++)u[c].element.classList.remove("active")}function p(a){for(var c=!1,d=0;d<b.length;d++)if(-1!==b[d].tags.indexOf(a.innerHTML)){c=!0;break}c&&a.classList.add("active")}function q(){for(var a=0;a<t.length;a++)for(var b=a+1;b<t.length;b++)if(-1===u[t[a]].neighbours.indexOf(t[b])||-1===u[t[b]].neighbours.indexOf(t[a]))return!1;return!0}function r(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null==c?"":decodeURIComponent(c[1].replace(/\+/g," "))}var s=[],t=[],u={};d(),e(),f()};